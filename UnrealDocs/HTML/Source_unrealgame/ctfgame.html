<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
	<title>UT2004 UnrealScript - Source: UnrealGame.CTFGame</title>
	<meta name="Generator" content="UnCodeX 241" />
	<link rel="stylesheet" href="../DocStyle2.css" type="text/css" title="Original Purple" />
	<link rel="alternative stylesheet" href="../DocStyle2-blue.css" type="text/css" title="Blue" />
	<link rel="alternative stylesheet" href="../DocStyle2-red.css" type="text/css" title="Red" />
	<!--[if IE]>
	<link rel="stylesheet" href="../DocStyle2-msie.css" type="text/css" />
	<![endif]-->
	<script src="../styleswitcher.js" type="text/javascript"></script>
</head>
<body>

<div class="header">
<table class="header">
<tr class="header">
	<td class="header"><a href="../overview.html">Overview</a></td>
	<td class="header"><a href="../unrealgame/unrealgame-overview.html">Package</a></td>
	<td class="header"><a href="../unrealgame/ctfgame.html">Class</a></td>
	<td class="header_hilight">Source</td>
	<td class="header"><a class="header" href="../classtree.html#CTFGame">Class tree</a></td>
	<td class="header"><a class="header" href="../glossary_A.html">Glossary</a></td>
	<td class="logo" rowspan="2">UnrealScript<br />Documentation</td>
</tr>
<tr>
	<td class="subheader" colspan="3"><a href="../Source_unrealgame/ctfflag.html">previous class</a> &nbsp;&nbsp;&nbsp;&nbsp; <a href="../Source_unrealgame/ctfhudmessage.html">next class</a></td>
	<td class="subheader" colspan="2"><a href="../index.html#Source_unrealgame/ctfgame.html" target="_top">frames</a> &nbsp;&nbsp;&nbsp;&nbsp; <a href="" target="_top">no frames</a></td>
</tr>
</table>
</div>
<div class="spacer"></div>

<h1><a href="../unrealgame/unrealgame-overview.html">UnrealGame</a>.<a href="../unrealgame/ctfgame.html">CTFGame</a></h1>
<br />
<div class="source"><table class="source"><tr><td class="source_lineno"><span class="source_lineno">00001<br />00002<br />00003<br />00004<br />00005<br />00006<br />00007<br />00008<br />00009<br />00010<br />00011<br />00012<br />00013<br />00014<br />00015<br />00016<br />00017<br />00018<br />00019<br />00020<br />
00021<br />00022<br />00023<br />00024<br />00025<br />00026<br />00027<br />00028<br />00029<br />00030<br />00031<br />00032<br />00033<br />00034<br />00035<br />00036<br />00037<br />00038<br />00039<br />00040<br />
00041<br />00042<br />00043<br />00044<br />00045<br />00046<br />00047<br />00048<br />00049<br />00050<br />00051<br />00052<br />00053<br />00054<br />00055<br />00056<br />00057<br />00058<br />00059<br />00060<br />
00061<br />00062<br />00063<br />00064<br />00065<br />00066<br />00067<br />00068<br />00069<br />00070<br />00071<br />00072<br />00073<br />00074<br />00075<br />00076<br />00077<br />00078<br />00079<br />00080<br />
00081<br />00082<br />00083<br />00084<br />00085<br />00086<br />00087<br />00088<br />00089<br />00090<br />00091<br />00092<br />00093<br />00094<br />00095<br />00096<br />00097<br />00098<br />00099<br />00100<br />
00101<br />00102<br />00103<br />00104<br />00105<br />00106<br />00107<br />00108<br />00109<br />00110<br />00111<br />00112<br />00113<br />00114<br />00115<br />00116<br />00117<br />00118<br />00119<br />00120<br />
00121<br />00122<br />00123<br />00124<br />00125<br />00126<br />00127<br />00128<br />00129<br />00130<br />00131<br />00132<br />00133<br />00134<br />00135<br />00136<br />00137<br />00138<br />00139<br />00140<br />
00141<br />00142<br />00143<br />00144<br />00145<br />00146<br />00147<br />00148<br />00149<br />00150<br />00151<br />00152<br />00153<br />00154<br />00155<br />00156<br />00157<br />00158<br />00159<br />00160<br />
00161<br />00162<br />00163<br />00164<br />00165<br />00166<br />00167<br />00168<br />00169<br />00170<br />00171<br />00172<br />00173<br />00174<br />00175<br />00176<br />00177<br />00178<br />00179<br />00180<br />
00181<br />00182<br />00183<br />00184<br />00185<br />00186<br />00187<br />00188<br />00189<br />00190<br />00191<br />00192<br />00193<br />00194<br />00195<br />00196<br />00197<br />00198<br />00199<br />00200<br />
00201<br />00202<br />00203<br />00204<br />00205<br />00206<br />00207<br />00208<br />00209<br />00210<br />00211<br />00212<br />00213<br />00214<br />00215<br />00216<br />00217<br />00218<br />00219<br />00220<br />
00221<br />00222<br />00223<br />00224<br />00225<br />00226<br />00227<br />00228<br />00229<br />00230<br />00231<br />00232<br />00233<br />00234<br />00235<br />00236<br />00237<br />00238<br />00239<br />00240<br />
00241<br />00242<br />00243<br />00244<br />00245<br />00246<br />00247<br />00248<br />00249<br />00250<br />00251<br />00252<br />00253<br />00254<br />00255<br />00256<br />00257<br />00258<br />00259<br />00260<br />
00261<br />00262<br />00263<br />00264<br />00265<br />00266<br />00267<br />00268<br />00269<br />00270<br />00271<br />00272<br />00273<br />00274<br />00275<br />00276<br />00277<br />00278<br />00279<br />00280<br />
00281<br />00282<br />00283<br />00284<br />00285<br />00286<br />00287<br />00288<br />00289<br />00290<br />00291<br />00292<br />00293<br />00294<br />00295<br />00296<br />00297<br />00298<br />00299<br />00300<br />
00301<br />00302<br />00303<br />00304<br />00305<br />00306<br />00307<br />00308<br />00309<br />00310<br />00311<br />00312<br />00313<br />00314<br />00315<br />00316<br />00317<br />00318<br />00319<br />00320<br />
00321<br />00322<br />00323<br />00324<br />00325<br />00326<br />00327<br />00328<br />00329<br />00330<br />00331<br />00332<br />00333<br />00334<br />00335<br />00336<br />00337<br />00338</span></td>
<td class="source"><pre class="source"><a name="1"></a><span class="source_comment">//=============================================================================
</span><a name="2"></a><span class="source_comment">// CTFGame.
</span><a name="3"></a><span class="source_comment">//=============================================================================
</span><a name="4"></a><span class="source_keyword">class</span> <span class="source_type"><a href="../unrealgame/ctfgame.html" class="source">CTFGame</a></span> <span class="source_keyword">extends</span> <span class="source_type"><a href="../unrealgame/teamgame.html" class="source">TeamGame</a></span>
<a name="5"></a>	<span class="source_keyword2">CacheExempt</span>
<a name="6"></a>	<span class="source_keyword2">config</span>;
<a name="7"></a>
<a name="8"></a><span class="source_keyword">var</span>(LoadingHints) <span class="source_keyword2">private</span> <span class="source_keyword2">localized</span> <span class="source_keyword">array</span>&lt;<span class="source_keyword">string</span>&gt; CTFHints;
<a name="9"></a>
<a name="10"></a><span class="source_keyword">function</span> PostBeginPlay()
<a name="11"></a>{
<a name="12"></a>	<span class="source_keyword">Super</span>.PostBeginPlay();
<a name="13"></a>	SetTeamFlags();
<a name="14"></a>}
<a name="15"></a>
<a name="16"></a><span class="source_keyword">function</span> RegisterVehicle(<span class="source_type"><a href="../engine/vehicle.html" class="source">Vehicle</a></span> <span class="source_type">V</span>)
<a name="17"></a>{
<a name="18"></a>	<span class="source_keyword">Super</span>.RegisterVehicle(<span class="source_type">V</span>);
<a name="19"></a>	<span class="source_comment">//V.bTeamLocked = false;
</span><a name="20"></a>}
<a name="21"></a>
<a name="22"></a><span class="source_keyword2">static</span> <span class="source_keyword">function</span> PrecacheGameAnnouncements(<span class="source_type"><a href="../engine/announcervoice.html" class="source">AnnouncerVoice</a></span> <span class="source_type">V</span>, <span class="source_keyword">bool</span> <span class="source_type">bRewardSounds</span>)
<a name="23"></a>{
<a name="24"></a>	<span class="source_keyword">Super</span>.PrecacheGameAnnouncements(<span class="source_type">V</span>,<span class="source_type">bRewardSounds</span>);
<a name="25"></a>	<span class="source_keyword">if</span> ( !<span class="source_type">bRewardSounds</span> )
<a name="26"></a>	{
<a name="27"></a>		<span class="source_type">V</span>.PrecacheSound(<span class="source_name">'Red_Flag_Returned'</span>);
<a name="28"></a>		<span class="source_type">V</span>.PrecacheSound(<span class="source_name">'Blue_Flag_Returned'</span>);
<a name="29"></a>		<span class="source_type">V</span>.PrecacheSound(<span class="source_name">'Red_Flag_Dropped'</span>);
<a name="30"></a>		<span class="source_type">V</span>.PrecacheSound(<span class="source_name">'Blue_Flag_Dropped'</span>);
<a name="31"></a>		<span class="source_type">V</span>.PrecacheSound(<span class="source_name">'Red_Flag_Taken'</span>);
<a name="32"></a>		<span class="source_type">V</span>.PrecacheSound(<span class="source_name">'Blue_Flag_Taken'</span>);
<a name="33"></a>	}
<a name="34"></a>	<span class="source_keyword">else</span>
<a name="35"></a>			<span class="source_type">V</span>.PrecacheSound(<span class="source_name">'Denied'</span>);
<a name="36"></a>}
<a name="37"></a>
<a name="38"></a><span class="source_comment">/* OBSOLETE UpdateAnnouncements() - preload all announcer phrases used by this actor */</span>
<a name="39"></a><span class="source_keyword2">simulated</span> <span class="source_keyword">function</span> UpdateAnnouncements() {}
<a name="40"></a>
<a name="41"></a><span class="source_keyword">function</span> <span class="source_keyword">bool</span> NearGoal(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span> <span class="source_type">C</span>)
<a name="42"></a>{
<a name="43"></a>	<span class="source_keyword">local</span> <span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span> <span class="source_type">P</span>;
<a name="44"></a>
<a name="45"></a>	<span class="source_type">P</span> = <span class="source_type">C</span>.<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>;
<a name="46"></a>	<span class="source_keyword">return</span> ( <span class="source_type"><a href="../unrealgame/ctfbase.html" class="source">CTFBase</a></span>(<span class="source_type">P</span>.<span class="source_type">Team</span>.HomeBase).myFlag.bHome && (VSize(<span class="source_type">C</span>.<span class="source_type"><a href="../engine/pawn.html" class="source">Pawn</a></span>.Location - <span class="source_type">P</span>.<span class="source_type">Team</span>.HomeBase.Location) &lt; <span class="source_int">1000</span>) );
<a name="47"></a>}
<a name="48"></a>
<a name="49"></a><span class="source_keyword2">static</span> <span class="source_keyword">function</span> <span class="source_keyword">int</span> OrderToIndex(<span class="source_keyword">int</span> Order)
<a name="50"></a>{
<a name="51"></a>	<span class="source_keyword">if</span>(Order == <span class="source_int">2</span>)
<a name="52"></a>		<span class="source_keyword">return</span> <span class="source_int">10</span>;
<a name="53"></a>
<a name="54"></a>	<span class="source_keyword">if</span>(Order == <span class="source_int">0</span>)
<a name="55"></a>		<span class="source_keyword">return</span> <span class="source_int">11</span>;
<a name="56"></a>
<a name="57"></a>	<span class="source_keyword">return</span> Order;
<a name="58"></a>}
<a name="59"></a>
<a name="60"></a><span class="source_keyword">function</span> <span class="source_keyword">float</span> SpawnWait(<span class="source_type"><a href="../engine/aicontroller.html" class="source">AIController</a></span> <span class="source_type">B</span>)
<a name="61"></a>{
<a name="62"></a>	<span class="source_keyword">if</span> ( <span class="source_type">B</span>.<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.bOutOfLives )
<a name="63"></a>		<span class="source_keyword">return</span> <span class="source_int">999</span>;
<a name="64"></a>	<span class="source_keyword">if</span> ( <span class="source_type">Level</span>.NetMode == NM_Standalone )
<a name="65"></a>	{
<a name="66"></a>		<span class="source_keyword">if</span> ( NumBots &lt; <span class="source_int">4</span> )
<a name="67"></a>			<span class="source_keyword">return</span> <span class="source_int">0</span>;
<a name="68"></a>		<span class="source_keyword">if</span> ( !<span class="source_type"><a href="../unrealgame/ctfsquadai.html" class="source">CTFSquadAI</a></span>(<span class="source_type"><a href="../unrealgame/bot.html" class="source">Bot</a></span>(<span class="source_type">B</span>).Squad).FriendlyFlag.bHome && (Numbots &lt;= <span class="source_int">16</span>) )
<a name="69"></a>			<span class="source_keyword">return</span> FRand();
<a name="70"></a>		<span class="source_keyword">return</span> ( <span class="source_int">0.5</span> * FMax(<span class="source_int">2</span>,NumBots-<span class="source_int">4</span>) * FRand() );
<a name="71"></a>	}
<a name="72"></a>	<span class="source_keyword">return</span> FRand();
<a name="73"></a>}
<a name="74"></a>
<a name="75"></a><span class="source_keyword">function</span> SetTeamFlags()
<a name="76"></a>{
<a name="77"></a>	<span class="source_keyword">local</span> <span class="source_type"><a href="../unrealgame/ctfflag.html" class="source">CTFFlag</a></span> <span class="source_type">F</span>;
<a name="78"></a>
<a name="79"></a>	<span class="source_comment">// associate flags with teams
</span><a name="80"></a>	<span class="source_keyword">ForEach</span> AllActors(<span class="source_keyword">Class</span><span class="source_name">'CTFFlag'</span>,<span class="source_type">F</span>)
<a name="81"></a>	{
<a name="82"></a>		<span class="source_type">F</span>.<span class="source_type">Team</span> = Teams[<span class="source_type">F</span>.<span class="source_type">TeamNum</span>];
<a name="83"></a>		<span class="source_type">F</span>.<span class="source_type">Team</span>.HomeBase = <span class="source_type">F</span>.HomeBase;
<a name="84"></a>		<span class="source_type"><a href="../unrealgame/ctfteamai.html" class="source">CTFTeamAI</a></span>(<span class="source_type">F</span>.<span class="source_type">Team</span>.AI).FriendlyFlag = <span class="source_type">F</span>;
<a name="85"></a>		<span class="source_keyword">if</span> ( <span class="source_type">F</span>.<span class="source_type">TeamNum</span> == <span class="source_int">0</span> )
<a name="86"></a>			<span class="source_type"><a href="../unrealgame/ctfteamai.html" class="source">CTFTeamAI</a></span>(Teams[<span class="source_int">1</span>].AI).EnemyFlag = <span class="source_type">F</span>;
<a name="87"></a>		<span class="source_keyword">else</span>
<a name="88"></a>			<span class="source_type"><a href="../unrealgame/ctfteamai.html" class="source">CTFTeamAI</a></span>(Teams[<span class="source_int">0</span>].AI).EnemyFlag = <span class="source_type">F</span>;
<a name="89"></a>	}
<a name="90"></a>}
<a name="91"></a>
<a name="92"></a><span class="source_keyword">function</span> <span class="source_type"><a href="../unrealgame/gameobject.html" class="source">GameObject</a></span> GetGameObject( <span class="source_keyword">Name</span> <span class="source_type">GameObjectName</span> )
<a name="93"></a>{
<a name="94"></a>	<span class="source_keyword">local</span> <span class="source_keyword">int</span> <span class="source_type">i</span>;
<a name="95"></a>
<a name="96"></a>	<span class="source_keyword">for</span> ( <span class="source_type">i</span> = <span class="source_int">0</span>; <span class="source_type">i</span> &lt; ArrayCount(Teams); <span class="source_type">i</span>++ )
<a name="97"></a>	{
<a name="98"></a>		<span class="source_keyword">if</span> ( <span class="source_type"><a href="../unrealgame/ctfteamai.html" class="source">CTFTeamAI</a></span>(Teams[<span class="source_type">i</span>].AI).FriendlyFlag.IsA(<span class="source_type">GameObjectName</span>) )
<a name="99"></a>			<span class="source_keyword">return</span> <span class="source_type"><a href="../unrealgame/ctfteamai.html" class="source">CTFTeamAI</a></span>(Teams[<span class="source_type">i</span>].AI).FriendlyFlag;
<a name="100"></a>	}
<a name="101"></a>
<a name="102"></a>	<span class="source_keyword">return</span> <span class="source_keyword">Super</span>.GetGameObject(<span class="source_type">GameObjectName</span>);
<a name="103"></a>}
<a name="104"></a>
<a name="105"></a><span class="source_keyword">function</span> Logout(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span> <span class="source_type">Exiting</span>)
<a name="106"></a>{
<a name="107"></a>	<span class="source_keyword">if</span> ( <span class="source_type">Exiting</span>.<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.HasFlag != <span class="source_keyword">None</span> )
<a name="108"></a>		<span class="source_type"><a href="../unrealgame/ctfflag.html" class="source">CTFFlag</a></span>(<span class="source_type">Exiting</span>.<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.HasFlag).Drop(vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">0</span>));
<a name="109"></a>	<span class="source_keyword">Super</span>.Logout(<span class="source_type">Exiting</span>);
<a name="110"></a>}
<a name="111"></a>
<a name="112"></a><span class="source_keyword">function</span> <span class="source_keyword">bool</span> CheckEndGame(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span> Winner, <span class="source_keyword">string</span> <span class="source_type">Reason</span>)
<a name="113"></a>{
<a name="114"></a>	<span class="source_keyword">local</span> <span class="source_type"><a href="../unrealgame/ctfflag.html" class="source">CTFFlag</a></span> BestFlag;
<a name="115"></a>	<span class="source_keyword">local</span> <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span> <span class="source_type">P</span>;
<a name="116"></a>	<span class="source_keyword">local</span> <span class="source_type"><a href="../engine/playercontroller.html" class="source">PlayerController</a></span> <span class="source_type"><a href="../engine/player.html" class="source">Player</a></span>;
<a name="117"></a>    <span class="source_keyword">local</span> <span class="source_keyword">bool</span> bLastMan;
<a name="118"></a>
<a name="119"></a>	<span class="source_keyword">if</span> ( bOverTime )
<a name="120"></a>	{
<a name="121"></a>		<span class="source_keyword">if</span> ( Numbots + NumPlayers == <span class="source_int">0</span> )
<a name="122"></a>			<span class="source_keyword">return</span> <span class="source_keyword">true</span>;
<a name="123"></a>		bLastMan = <span class="source_keyword">true</span>;
<a name="124"></a>		<span class="source_keyword">for</span> ( <span class="source_type">P</span>=<span class="source_type">Level</span>.ControllerList; <span class="source_type">P</span>!=<span class="source_keyword">None</span>; <span class="source_type">P</span>=<span class="source_type">P</span>.nextController )
<a name="125"></a>			<span class="source_keyword">if</span> ( (<span class="source_type">P</span>.<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span> != <span class="source_keyword">None</span>) && !<span class="source_type">P</span>.<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.bOutOfLives )
<a name="126"></a>			{
<a name="127"></a>				bLastMan = <span class="source_keyword">false</span>;
<a name="128"></a>				<span class="source_keyword">break</span>;
<a name="129"></a>			}
<a name="130"></a>		<span class="source_keyword">if</span> ( bLastMan )
<a name="131"></a>			<span class="source_keyword">return</span> <span class="source_keyword">true</span>;
<a name="132"></a>	}
<a name="133"></a>
<a name="134"></a>    bLastMan = ( <span class="source_type">Reason</span> ~= <span class="source_string">"LastMan"</span> );
<a name="135"></a>
<a name="136"></a>	<span class="source_keyword">if</span> ( (GameRulesModifiers != <span class="source_keyword">None</span>) && !GameRulesModifiers.CheckEndGame(Winner, <span class="source_type">Reason</span>) )
<a name="137"></a>		<span class="source_keyword">return</span> <span class="source_keyword">false</span>;
<a name="138"></a>
<a name="139"></a>	<span class="source_keyword">if</span> ( bLastMan )
<a name="140"></a>		<span class="source_type"><a href="../engine/gamereplicationinfo.html" class="source">GameReplicationInfo</a></span>.Winner = Winner.<span class="source_type">Team</span>;
<a name="141"></a>	<span class="source_keyword">else</span>
<a name="142"></a>	{
<a name="143"></a>		<span class="source_keyword">if</span> ( Teams[<span class="source_int">1</span>].<span class="source_type">Score</span> == Teams[<span class="source_int">0</span>].<span class="source_type">Score</span> )
<a name="144"></a>		{
<a name="145"></a>			<span class="source_keyword">if</span> ( !bOverTimeBroadcast )
<a name="146"></a>			{
<a name="147"></a>				StartupStage = <span class="source_int">7</span>;
<a name="148"></a>				PlayStartupMessage();
<a name="149"></a>				bOverTimeBroadcast = <span class="source_keyword">true</span>;
<a name="150"></a>			}
<a name="151"></a>			<span class="source_keyword">return</span> <span class="source_keyword">false</span>;
<a name="152"></a>		}
<a name="153"></a>		<span class="source_keyword">if</span> ( Teams[<span class="source_int">1</span>].<span class="source_type">Score</span> &gt; Teams[<span class="source_int">0</span>].<span class="source_type">Score</span> )
<a name="154"></a>			<span class="source_type"><a href="../engine/gamereplicationinfo.html" class="source">GameReplicationInfo</a></span>.Winner = Teams[<span class="source_int">1</span>];
<a name="155"></a>		<span class="source_keyword">else</span>
<a name="156"></a>			<span class="source_type"><a href="../engine/gamereplicationinfo.html" class="source">GameReplicationInfo</a></span>.Winner = Teams[<span class="source_int">0</span>];
<a name="157"></a>	}
<a name="158"></a>
<a name="159"></a>	BestFlag = <span class="source_type"><a href="../unrealgame/ctfteamai.html" class="source">CTFTeamAI</a></span>(<span class="source_type"><a href="../unrealgame/unrealteaminfo.html" class="source">UnrealTeamInfo</a></span>(<span class="source_type"><a href="../engine/gamereplicationinfo.html" class="source">GameReplicationInfo</a></span>.Winner).AI).FriendlyFlag;
<a name="160"></a>	EndGameFocus = BestFlag.HomeBase;
<a name="161"></a>	EndGameFocus.bHidden = <span class="source_keyword">false</span>;
<a name="162"></a>
<a name="163"></a>	EndTime = <span class="source_type">Level</span>.TimeSeconds + EndTimeDelay;
<a name="164"></a>	<span class="source_keyword">for</span> ( <span class="source_type">P</span>=<span class="source_type">Level</span>.ControllerList; <span class="source_type">P</span>!=<span class="source_keyword">None</span>; <span class="source_type">P</span>=<span class="source_type">P</span>.nextController )
<a name="165"></a>	{
<a name="166"></a>		<span class="source_type">P</span>.GameHasEnded();
<a name="167"></a>		<span class="source_type"><a href="../engine/player.html" class="source">Player</a></span> = <span class="source_type"><a href="../engine/playercontroller.html" class="source">PlayerController</a></span>(<span class="source_type">P</span>);
<a name="168"></a>		<span class="source_keyword">if</span> ( <span class="source_type"><a href="../engine/player.html" class="source">Player</a></span> != <span class="source_keyword">None</span> )
<a name="169"></a>		{
<a name="170"></a>			<span class="source_type"><a href="../engine/player.html" class="source">Player</a></span>.ClientSetBehindView(<span class="source_keyword">true</span>);
<a name="171"></a>			<span class="source_type"><a href="../engine/player.html" class="source">Player</a></span>.ClientSetViewTarget(EndGameFocus);
<a name="172"></a>			<span class="source_type"><a href="../engine/player.html" class="source">Player</a></span>.SetViewTarget(EndGameFocus);
<a name="173"></a>			<span class="source_keyword">if</span> ( !<span class="source_type"><a href="../engine/player.html" class="source">Player</a></span>.<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.bOnlySpectator )
<a name="174"></a>				PlayWinMessage(<span class="source_type"><a href="../engine/player.html" class="source">Player</a></span>, (<span class="source_type"><a href="../engine/player.html" class="source">Player</a></span>.<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.<span class="source_type">Team</span> == <span class="source_type"><a href="../engine/gamereplicationinfo.html" class="source">GameReplicationInfo</a></span>.Winner));
<a name="175"></a>			<span class="source_type"><a href="../engine/player.html" class="source">Player</a></span>.ClientGameEnded();
<a name="176"></a>			<span class="source_keyword">if</span> ( CurrentGameProfile != <span class="source_keyword">None</span> )
<a name="177"></a>				CurrentGameProfile.bWonMatch = (<span class="source_type"><a href="../engine/player.html" class="source">Player</a></span>.<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.<span class="source_type">Team</span> == <span class="source_type"><a href="../engine/gamereplicationinfo.html" class="source">GameReplicationInfo</a></span>.Winner);
<a name="178"></a>		}
<a name="179"></a>	}
<a name="180"></a>	BestFlag.HomeBase.bHidden = <span class="source_keyword">false</span>;
<a name="181"></a>	BestFlag.bHidden = <span class="source_keyword">true</span>;
<a name="182"></a>	<span class="source_keyword">return</span> <span class="source_keyword">true</span>;
<a name="183"></a>}
<a name="184"></a>
<a name="185"></a><span class="source_keyword">function</span> ScoreGameObject( <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span> <span class="source_type">C</span>, <span class="source_type"><a href="../unrealgame/gameobject.html" class="source">GameObject</a></span> <span class="source_type">GO</span> )
<a name="186"></a>{
<a name="187"></a>	<span class="source_keyword">Super</span>.ScoreGameObject(<span class="source_type">C</span>,<span class="source_type">GO</span>);
<a name="188"></a>	<span class="source_keyword">if</span> ( <span class="source_type">GO</span>.IsA(<span class="source_name">'CTFFlag'</span>) )
<a name="189"></a>		ScoreFlag(<span class="source_type">C</span>, <span class="source_type"><a href="../unrealgame/ctfflag.html" class="source">CTFFlag</a></span>(<span class="source_type">GO</span>));
<a name="190"></a>}
<a name="191"></a>
<a name="192"></a><span class="source_keyword">function</span> ScoreFlag(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span> Scorer, <span class="source_type"><a href="../unrealgame/ctfflag.html" class="source">CTFFlag</a></span> theFlag)
<a name="193"></a>{
<a name="194"></a>	<span class="source_keyword">local</span> <span class="source_keyword">float</span> <span class="source_type">Dist</span>,oppDist;
<a name="195"></a>	<span class="source_keyword">local</span> <span class="source_keyword">int</span> <span class="source_type">i</span>;
<a name="196"></a>	<span class="source_keyword">local</span> <span class="source_keyword">float</span> ppp,numtouch;
<a name="197"></a>	<span class="source_keyword">local</span> <span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span> FlagLoc;
<a name="198"></a>
<a name="199"></a>	<span class="source_keyword">if</span> ( Scorer.<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.<span class="source_type">Team</span> == theFlag.<span class="source_type">Team</span> )
<a name="200"></a>	{
<a name="201"></a>		Scorer.AwardAdrenaline(ADR_Return);
<a name="202"></a>		FlagLoc = TheFlag.<span class="source_type">Position</span>().Location;
<a name="203"></a>		<span class="source_type">Dist</span> = vsize(FlagLoc - TheFlag.HomeBase.Location);
<a name="204"></a>
<a name="205"></a>		<span class="source_keyword">if</span> (TheFlag.<span class="source_type">TeamNum</span>==<span class="source_int">0</span>)
<a name="206"></a>			oppDist = vsize(FlagLoc - Teams[<span class="source_int">1</span>].HomeBase.Location);
<a name="207"></a>		<span class="source_keyword">else</span>
<a name="208"></a>  			oppDist = vsize(FlagLoc - Teams[<span class="source_int">0</span>].HomeBase.Location);
<a name="209"></a>
<a name="210"></a>		GameEvent(<span class="source_string">"flag_returned"</span>,<span class="source_string">""</span>$theFlag.<span class="source_type">Team</span>.TeamIndex,Scorer.<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>);
<a name="211"></a>		BroadcastLocalizedMessage( <span class="source_keyword">class</span><span class="source_name">'CTFMessage'</span>, <span class="source_int">1</span>, Scorer.<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>, <span class="source_keyword">None</span>, TheFlag.<span class="source_type">Team</span> );
<a name="212"></a>
<a name="213"></a>		<span class="source_keyword">if</span> (<span class="source_type">Dist</span>&gt;<span class="source_int">1024</span>)
<a name="214"></a>		{
<a name="215"></a>			<span class="source_comment">// figure out who's closer
</span><a name="216"></a>			<span class="source_keyword">if</span> (<span class="source_type">Dist</span>&lt;=oppDist)	<span class="source_comment">// In your team's zone
</span><a name="217"></a>			{
<a name="218"></a>				Scorer.<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.<span class="source_type">Score</span> += <span class="source_int">3</span>;
<a name="219"></a>				ScoreEvent(Scorer.<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>,<span class="source_int">3</span>,<span class="source_string">"flag_ret_friendly"</span>);
<a name="220"></a>			}
<a name="221"></a>			<span class="source_keyword">else</span>
<a name="222"></a>			{
<a name="223"></a>				Scorer.<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.<span class="source_type">Score</span> += <span class="source_int">5</span>;
<a name="224"></a>				ScoreEvent(Scorer.<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>,<span class="source_int">5</span>,<span class="source_string">"flag_ret_enemy"</span>);
<a name="225"></a>
<a name="226"></a>				<span class="source_keyword">if</span> (oppDist&lt;=<span class="source_int">1024</span>)	<span class="source_comment">// Denial
</span><a name="227"></a>				{
<a name="228"></a>  					Scorer.<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.<span class="source_type">Score</span> += <span class="source_int">7</span>;
<a name="229"></a>					ScoreEvent(Scorer.<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>,<span class="source_int">7</span>,<span class="source_string">"flag_denial"</span>);
<a name="230"></a>				}
<a name="231"></a>
<a name="232"></a>			}
<a name="233"></a>		}
<a name="234"></a>		<span class="source_keyword">return</span>;
<a name="235"></a>	}
<a name="236"></a>
<a name="237"></a>	<span class="source_comment">// Figure out Team based scoring.
</span><a name="238"></a>	<span class="source_keyword">if</span> (TheFlag.FirstTouch!=<span class="source_keyword">None</span>)	<span class="source_comment">// Original Player to Touch it gets 5
</span><a name="239"></a>	{
<a name="240"></a>		ScoreEvent(TheFlag.FirstTouch.<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>,<span class="source_int">5</span>,<span class="source_string">"flag_cap_1st_touch"</span>);
<a name="241"></a>		TheFlag.FirstTouch.<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.<span class="source_type">Score</span> += <span class="source_int">5</span>;
<a name="242"></a>		TheFlag.FirstTouch.<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.NetUpdateTime = <span class="source_type">Level</span>.TimeSeconds - <span class="source_int">1</span>;
<a name="243"></a>	}
<a name="244"></a>
<a name="245"></a>	<span class="source_comment">// Guy who caps gets 5
</span><a name="246"></a>	Scorer.<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.NetUpdateTime = <span class="source_type">Level</span>.TimeSeconds - <span class="source_int">1</span>;
<a name="247"></a>	Scorer.<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.<span class="source_type">Score</span> += <span class="source_int">5</span>;
<a name="248"></a>	IncrementGoalsScored(Scorer.<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>);
<a name="249"></a>    Scorer.AwardAdrenaline(ADR_Goal);
<a name="250"></a>
<a name="251"></a>	<span class="source_comment">// Each player gets 20/x but it's guarenteed to be at least 1 point but no more than 5 points
</span><a name="252"></a>	numtouch=<span class="source_int">0</span>;
<a name="253"></a>	<span class="source_keyword">for</span> (<span class="source_type">i</span>=<span class="source_int">0</span>;<span class="source_type">i</span>&lt;TheFlag.Assists.length;<span class="source_type">i</span>++)
<a name="254"></a>	{
<a name="255"></a>		<span class="source_keyword">if</span> (TheFlag.Assists[<span class="source_type">i</span>]!=<span class="source_keyword">None</span>)
<a name="256"></a>			numtouch = numtouch + <span class="source_int">1.0</span>;
<a name="257"></a>	}
<a name="258"></a>
<a name="259"></a>	ppp = FClamp(<span class="source_int">20</span>/numtouch,<span class="source_int">1</span>,<span class="source_int">5</span>);
<a name="260"></a>
<a name="261"></a>	<span class="source_keyword">for</span> (<span class="source_type">i</span>=<span class="source_int">0</span>;<span class="source_type">i</span>&lt;TheFlag.Assists.length;<span class="source_type">i</span>++)
<a name="262"></a>	{
<a name="263"></a>		<span class="source_keyword">if</span> (TheFlag.Assists[<span class="source_type">i</span>]!=<span class="source_keyword">None</span>)
<a name="264"></a>		{
<a name="265"></a>			ScoreEvent(TheFlag.Assists[<span class="source_type">i</span>].<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>,ppp,<span class="source_string">"flag_cap_assist"</span>);
<a name="266"></a>			TheFlag.Assists[<span class="source_type">i</span>].<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.<span class="source_type">Score</span> += <span class="source_keyword">int</span>(ppp);
<a name="267"></a>		}
<a name="268"></a>	}
<a name="269"></a>
<a name="270"></a>	<span class="source_comment">// Apply the team score
</span><a name="271"></a>	Scorer.<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.<span class="source_type">Team</span>.<span class="source_type">Score</span> += <span class="source_int">1.0</span>;
<a name="272"></a>	Scorer.<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.<span class="source_type">Team</span>.NetUpdateTime = <span class="source_type">Level</span>.TimeSeconds - <span class="source_int">1</span>;
<a name="273"></a>	ScoreEvent(Scorer.<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>,<span class="source_int">5</span>,<span class="source_string">"flag_cap_final"</span>);
<a name="274"></a>	TeamScoreEvent(Scorer.<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.<span class="source_type">Team</span>.TeamIndex,<span class="source_int">1</span>,<span class="source_string">"flag_cap"</span>);
<a name="275"></a>	GameEvent(<span class="source_string">"flag_captured"</span>,<span class="source_string">""</span>$theflag.<span class="source_type">Team</span>.TeamIndex,Scorer.<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>);
<a name="276"></a>
<a name="277"></a>	BroadcastLocalizedMessage( <span class="source_keyword">class</span><span class="source_name">'CTFMessage'</span>, <span class="source_int">0</span>, Scorer.<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>, <span class="source_keyword">None</span>, TheFlag.<span class="source_type">Team</span> );
<a name="278"></a>	AnnounceScore(Scorer.<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.<span class="source_type">Team</span>.TeamIndex);
<a name="279"></a>	CheckScore(Scorer.<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>);
<a name="280"></a>
<a name="281"></a>    <span class="source_keyword">if</span> ( bOverTime )
<a name="282"></a>    {
<a name="283"></a>		EndGame(Scorer.<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>,<span class="source_string">"timelimit"</span>);
<a name="284"></a>    }
<a name="285"></a>}
<a name="286"></a>
<a name="287"></a><span class="source_keyword">function</span> DiscardInventory( <span class="source_type"><a href="../engine/pawn.html" class="source">Pawn</a></span> <span class="source_type">Other</span> )
<a name="288"></a>{
<a name="289"></a>	<span class="source_keyword">if</span> ( (<span class="source_type">Other</span>.<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span> != <span class="source_keyword">None</span>) && (<span class="source_type">Other</span>.<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.HasFlag != <span class="source_keyword">None</span>) )
<a name="290"></a>		<span class="source_type"><a href="../unrealgame/ctfflag.html" class="source">CTFFlag</a></span>(<span class="source_type">Other</span>.<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.HasFlag).Drop(<span class="source_int">0.5</span> * <span class="source_type">Other</span>.Velocity);
<a name="291"></a>
<a name="292"></a>	<span class="source_keyword">Super</span>.DiscardInventory(<span class="source_type">Other</span>);
<a name="293"></a>
<a name="294"></a>}
<a name="295"></a>
<a name="296"></a><span class="source_keyword2">static</span> <span class="source_keyword">function</span> <span class="source_keyword">array</span>&lt;<span class="source_keyword">string</span>&gt; GetAllLoadHints(<span class="source_keyword2">optional</span> <span class="source_keyword">bool</span> bThisClassOnly)
<a name="297"></a>{
<a name="298"></a>	<span class="source_keyword">local</span> <span class="source_keyword">int</span> <span class="source_type">i</span>;
<a name="299"></a>	<span class="source_keyword">local</span> <span class="source_keyword">array</span>&lt;<span class="source_keyword">string</span>&gt; Hints;
<a name="300"></a>
<a name="301"></a>	<span class="source_keyword">if</span> ( !bThisClassOnly || default.CTFHints.Length == <span class="source_int">0</span> )
<a name="302"></a>		Hints = <span class="source_keyword">Super</span>.GetAllLoadHints();
<a name="303"></a>
<a name="304"></a>	<span class="source_keyword">for</span> ( <span class="source_type">i</span> = <span class="source_int">0</span>; <span class="source_type">i</span> &lt; default.CTFHints.Length; <span class="source_type">i</span>++ )
<a name="305"></a>		Hints[Hints.Length] = default.CTFHints[<span class="source_type">i</span>];
<a name="306"></a>
<a name="307"></a>	<span class="source_keyword">return</span> Hints;
<a name="308"></a>}
<a name="309"></a>
<a name="310"></a><span class="source_keyword">State</span> MatchOver
<a name="311"></a>{
<a name="312"></a>	<span class="source_keyword">function</span> ScoreFlag(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span> Scorer, <span class="source_type"><a href="../unrealgame/ctfflag.html" class="source">CTFFlag</a></span> theFlag)
<a name="313"></a>	{
<a name="314"></a>	}
<a name="315"></a>}
<a name="316"></a>
<a name="317"></a><span class="source_keyword">defaultproperties</span>
<a name="318"></a>{
<a name="319"></a>     CTFHints(<span class="source_int">0</span>)=<span class="source_string">"You can use %BASEPATH 0% to see the path to the Red Team base and %BASEPATH 1% to see the path to the Blue Team base."</span>
<a name="320"></a>     CTFHints(<span class="source_int">1</span>)=<span class="source_string">"Firing the translocator sends out your translocator beacon.  Pressing %FIRE% again returns the beacon, while pressing %A:TFIRE% teleports you instantly to the beacon's location (if you fit)."</span>
<a name="321"></a>     CTFHints(<span class="source_int">2</span>)=<span class="source_string">"Using the translocator to teleport while carrying the flag will cause you to drop the flag."</span>
<a name="322"></a>     CTFHints(<span class="source_int">3</span>)=<span class="source_string">"Pressing %SWITCHWEAPON 10% after tossing the Translocator allows you to view from its internal camera."</span>
<a name="323"></a>     CTFHints(<span class="source_int">4</span>)=<span class="source_string">"Pressing %FIRE% while your %ALTFIRE% is still held down after teleporting with the translocator will switch you back to your previous weapon."</span>
<a name="324"></a>     bScoreTeamKills=<span class="source_keyword">False</span>
<a name="325"></a>     bSpawnInTeamArea=<span class="source_keyword">True</span>
<a name="326"></a>     bScoreVictimsTarget=<span class="source_keyword">True</span>
<a name="327"></a>     TeamAIType(<span class="source_int">0</span>)=<span class="source_keyword">Class</span><span class="source_name">'UnrealGame.CTFTeamAI'</span>
<a name="328"></a>     TeamAIType(<span class="source_int">1</span>)=<span class="source_keyword">Class</span><span class="source_name">'UnrealGame.CTFTeamAI'</span>
<a name="329"></a>     bAllowTrans=<span class="source_keyword">True</span>
<a name="330"></a>     bDefaultTranslocator=<span class="source_keyword">True</span>
<a name="331"></a>     bMustHaveMultiplePlayers=<span class="source_keyword">False</span>
<a name="332"></a>     ADR_Kill=<span class="source_int">2.000000</span>
<a name="333"></a>     <span class="source_type">MapPrefix</span>=<span class="source_string">"CTF"</span>
<a name="334"></a>     BeaconName=<span class="source_string">"CTF"</span>
<a name="335"></a>     GoalScore=<span class="source_int">3</span>
<a name="336"></a>     Description=<span class="source_string">"Your team must score flag captures by taking the enemy flag from the enemy base and returning it to their own flag.  If the flag carrier is killed, the flag drops to the ground for anyone to pick up.  If your team's flag is taken, it must be returned (by touching it after it is dropped) before your team can score a flag capture."</span>
<a name="337"></a>}
<a name="338"></a></pre></td></tr></table></div>
<hr />
<table class="header">
<tr class="header">
	<td class="header"><a href="../overview.html">Overview</a></td>
	<td class="header"><a href="../unrealgame/unrealgame-overview.html">Package</a></td>
	<td class="header"><a href="../unrealgame/ctfgame.html">Class</a></td>
	<td class="header_hilight">Source</td>
	<td class="header"><a class="header" href="../classtree.html#CTFGame">Class tree</a></td>
	<td class="header"><a class="header" href="../glossary_A.html">Glossary</a></td>
	<td class="logo" rowspan="2">UnrealScript<br />Documentation</td>
</tr>
<tr>
	<td class="subheader" colspan="3"><a href="../Source_unrealgame/ctfflag.html">previous class</a> &nbsp;&nbsp;&nbsp;&nbsp; <a href="../Source_unrealgame/ctfhudmessage.html">next class</a></td>
	<td class="subheader" colspan="2"><a href="../index.html" target="_top">frames</a> &nbsp;&nbsp;&nbsp;&nbsp; <a href="" target="_top">no frames</a></td>
</tr>
</table>

<div class="stats">Class file time: Sun 31/3/2019 17:32:14.000 - Creation time: Mon 15/4/2019 10:25:09.877 - Created with <a href="http://wiki.beyondunreal.com/wiki/UnCodeX" target="_blank">UnCodeX</a></div>

</body>
</html>