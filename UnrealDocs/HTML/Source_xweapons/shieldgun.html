<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
	<title>UT2004 UnrealScript - Source: XWeapons.ShieldGun</title>
	<meta name="Generator" content="UnCodeX 241" />
	<link rel="stylesheet" href="../DocStyle2.css" type="text/css" title="Original Purple" />
	<link rel="alternative stylesheet" href="../DocStyle2-blue.css" type="text/css" title="Blue" />
	<link rel="alternative stylesheet" href="../DocStyle2-red.css" type="text/css" title="Red" />
	<!--[if IE]>
	<link rel="stylesheet" href="../DocStyle2-msie.css" type="text/css" />
	<![endif]-->
	<script src="../styleswitcher.js" type="text/javascript"></script>
</head>
<body>

<div class="header">
<table class="header">
<tr class="header">
	<td class="header"><a href="../overview.html">Overview</a></td>
	<td class="header"><a href="../xweapons/xweapons-overview.html">Package</a></td>
	<td class="header"><a href="../xweapons/shieldgun.html">Class</a></td>
	<td class="header_hilight">Source</td>
	<td class="header"><a class="header" href="../classtree.html#ShieldGun">Class tree</a></td>
	<td class="header"><a class="header" href="../glossary_A.html">Glossary</a></td>
	<td class="logo" rowspan="2">UnrealScript<br />Documentation</td>
</tr>
<tr>
	<td class="subheader" colspan="3"><a href="../Source_xweapons/shieldfire.html">previous class</a> &nbsp;&nbsp;&nbsp;&nbsp; <a href="../Source_xweapons/shieldgunpickup.html">next class</a></td>
	<td class="subheader" colspan="2"><a href="../index.html#Source_xweapons/shieldgun.html" target="_top">frames</a> &nbsp;&nbsp;&nbsp;&nbsp; <a href="" target="_top">no frames</a></td>
</tr>
</table>
</div>
<div class="spacer"></div>

<h1><a href="../xweapons/xweapons-overview.html">XWeapons</a>.<a href="../xweapons/shieldgun.html">ShieldGun</a></h1>
<br />
<div class="source"><table class="source"><tr><td class="source_lineno"><span class="source_lineno">00001<br />00002<br />00003<br />00004<br />00005<br />00006<br />00007<br />00008<br />00009<br />00010<br />00011<br />00012<br />00013<br />00014<br />00015<br />00016<br />00017<br />00018<br />00019<br />00020<br />
00021<br />00022<br />00023<br />00024<br />00025<br />00026<br />00027<br />00028<br />00029<br />00030<br />00031<br />00032<br />00033<br />00034<br />00035<br />00036<br />00037<br />00038<br />00039<br />00040<br />
00041<br />00042<br />00043<br />00044<br />00045<br />00046<br />00047<br />00048<br />00049<br />00050<br />00051<br />00052<br />00053<br />00054<br />00055<br />00056<br />00057<br />00058<br />00059<br />00060<br />
00061<br />00062<br />00063<br />00064<br />00065<br />00066<br />00067<br />00068<br />00069<br />00070<br />00071<br />00072<br />00073<br />00074<br />00075<br />00076<br />00077<br />00078<br />00079<br />00080<br />
00081<br />00082<br />00083<br />00084<br />00085<br />00086<br />00087<br />00088<br />00089<br />00090<br />00091<br />00092<br />00093<br />00094<br />00095<br />00096<br />00097<br />00098<br />00099<br />00100<br />
00101<br />00102<br />00103<br />00104<br />00105<br />00106<br />00107<br />00108<br />00109<br />00110<br />00111<br />00112<br />00113<br />00114<br />00115<br />00116<br />00117<br />00118<br />00119<br />00120<br />
00121<br />00122<br />00123<br />00124<br />00125<br />00126<br />00127<br />00128<br />00129<br />00130<br />00131<br />00132<br />00133<br />00134<br />00135<br />00136<br />00137<br />00138<br />00139<br />00140<br />
00141<br />00142<br />00143<br />00144<br />00145<br />00146<br />00147<br />00148<br />00149<br />00150<br />00151<br />00152<br />00153<br />00154<br />00155<br />00156<br />00157<br />00158<br />00159<br />00160<br />
00161<br />00162<br />00163<br />00164<br />00165<br />00166<br />00167<br />00168<br />00169<br />00170<br />00171<br />00172<br />00173<br />00174<br />00175<br />00176<br />00177<br />00178<br />00179<br />00180<br />
00181<br />00182<br />00183<br />00184<br />00185<br />00186<br />00187<br />00188<br />00189<br />00190<br />00191<br />00192<br />00193<br />00194<br />00195<br />00196<br />00197<br />00198<br />00199<br />00200<br />
00201<br />00202<br />00203<br />00204<br />00205<br />00206<br />00207<br />00208<br />00209<br />00210<br />00211<br />00212<br />00213<br />00214<br />00215<br />00216<br />00217<br />00218<br />00219<br />00220<br />
00221<br />00222<br />00223<br />00224<br />00225<br />00226<br />00227<br />00228<br />00229<br />00230<br />00231<br />00232<br />00233<br />00234<br />00235<br />00236<br />00237<br />00238<br />00239<br />00240<br />
00241<br />00242<br />00243<br />00244<br />00245<br />00246<br />00247<br />00248<br />00249<br />00250<br />00251<br />00252<br />00253<br />00254<br />00255<br />00256<br />00257<br />00258<br />00259<br />00260<br />
00261<br />00262<br />00263<br />00264<br />00265<br />00266<br />00267<br />00268<br />00269<br />00270<br />00271<br />00272<br />00273<br />00274<br />00275<br />00276<br />00277<br />00278<br />00279<br />00280<br />
00281<br />00282<br />00283<br />00284<br />00285<br />00286<br />00287<br />00288<br />00289<br />00290<br />00291<br />00292<br />00293<br />00294<br />00295<br />00296<br />00297<br />00298<br />00299<br />00300<br />
00301<br />00302<br />00303<br />00304<br />00305<br />00306<br />00307<br />00308<br />00309<br />00310<br />00311<br />00312<br />00313<br />00314<br />00315<br />00316<br />00317<br />00318<br />00319<br />00320<br />
00321<br />00322<br />00323<br />00324<br />00325<br />00326<br />00327<br />00328</span></td>
<td class="source"><pre class="source"><a name="1"></a><span class="source_comment">//=============================================================================
</span><a name="2"></a><span class="source_comment">// Shield Gun
</span><a name="3"></a><span class="source_comment">//=============================================================================
</span><a name="4"></a><span class="source_keyword">class</span> <span class="source_type"><a href="../xweapons/shieldgun.html" class="source">ShieldGun</a></span> <span class="source_keyword">extends</span> <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>
<a name="5"></a>    <span class="source_keyword2">config</span>(<span class="source_type">user</span>)
<a name="6"></a>    <span class="source_keyword2">HideDropDown</span>;
<a name="7"></a>
<a name="8"></a><span class="source_macro">#EXEC OBJ LOAD FILE=InterfaceContent.utx
</span><a name="9"></a>
<a name="10"></a><span class="source_keyword">var</span> <span class="source_type"><a href="../engine/sound.html" class="source">Sound</a></span>       ShieldHitSound;
<a name="11"></a><span class="source_keyword">var</span> <span class="source_keyword">String</span>		ShieldHitForce;
<a name="12"></a>
<a name="13"></a><span class="source_keyword">replication</span>
<a name="14"></a>{
<a name="15"></a>    <span class="source_keyword">reliable</span> <span class="source_keyword">if</span> (Role == ROLE_Authority)
<a name="16"></a>        ClientTakeHit;
<a name="17"></a>}
<a name="18"></a>
<a name="19"></a><span class="source_keyword2">simulated</span> <span class="source_keyword">function</span> DoAutoSwitch()
<a name="20"></a>{
<a name="21"></a>}
<a name="22"></a>
<a name="23"></a><span class="source_keyword2">simulated</span> <span class="source_keyword">function</span> <span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span> CenteredEffectStart()
<a name="24"></a>{
<a name="25"></a>    <span class="source_keyword">local</span> <span class="source_type"><a href="../core/object.html#Vector" class="source">Vector</a></span> <span class="source_type">X</span>,<span class="source_type">Y</span>,<span class="source_type">Z</span>;
<a name="26"></a>
<a name="27"></a>    GetViewAxes(<span class="source_type">X</span>, <span class="source_type">Y</span>, <span class="source_type">Z</span>);
<a name="28"></a>    <span class="source_keyword">return</span> (<span class="source_type">Instigator</span>.Location +
<a name="29"></a>        <span class="source_type">Instigator</span>.CalcDrawOffset(self) +
<a name="30"></a>        EffectOffset.<span class="source_type">X</span> * <span class="source_type">X</span> +
<a name="31"></a>        EffectOffset.<span class="source_type">Z</span> * <span class="source_type">Z</span>);
<a name="32"></a>}
<a name="33"></a>
<a name="34"></a><span class="source_keyword2">simulated</span> <span class="source_keyword">event</span> RenderOverlays( <span class="source_type"><a href="../engine/canvas.html" class="source">Canvas</a></span> <span class="source_type"><a href="../engine/canvas.html" class="source">Canvas</a></span> )
<a name="35"></a>{
<a name="36"></a>    <span class="source_keyword">local</span> <span class="source_keyword">int</span> <span class="source_type">m</span>;
<a name="37"></a>
<a name="38"></a>    <span class="source_keyword">if</span> ((Hand &lt; -<span class="source_int">1.0</span>) || (Hand &gt; <span class="source_int">1.0</span>))
<a name="39"></a>    {
<a name="40"></a>		<span class="source_keyword">for</span> (<span class="source_type">m</span> = <span class="source_int">0</span>; <span class="source_type">m</span> &lt; NUM_FIRE_MODES; <span class="source_type">m</span>++)
<a name="41"></a>		{
<a name="42"></a>			<span class="source_keyword">if</span> (FireMode[<span class="source_type">m</span>] != <span class="source_keyword">None</span>)
<a name="43"></a>			{
<a name="44"></a>				FireMode[<span class="source_type">m</span>].DrawMuzzleFlash(<span class="source_type"><a href="../engine/canvas.html" class="source">Canvas</a></span>);
<a name="45"></a>			}
<a name="46"></a>		}
<a name="47"></a>	}
<a name="48"></a>    <span class="source_keyword">Super</span>.RenderOverlays(<span class="source_type"><a href="../engine/canvas.html" class="source">Canvas</a></span>);
<a name="49"></a>}
<a name="50"></a>
<a name="51"></a><span class="source_comment">// AI Interface
</span><a name="52"></a><span class="source_keyword">function</span> GiveTo(<span class="source_type"><a href="../engine/pawn.html" class="source">Pawn</a></span> <span class="source_type">Other</span>, <span class="source_keyword2">optional</span> <span class="source_type"><a href="../engine/pickup.html" class="source">Pickup</a></span> <span class="source_type"><a href="../engine/pickup.html" class="source">Pickup</a></span>)
<a name="53"></a>{
<a name="54"></a>	<span class="source_keyword">Super</span>.GiveTo(<span class="source_type">Other</span>, <span class="source_type"><a href="../engine/pickup.html" class="source">Pickup</a></span>);
<a name="55"></a>
<a name="56"></a>	<span class="source_keyword">if</span> ( <span class="source_type"><a href="../unrealgame/bot.html" class="source">Bot</a></span>(<span class="source_type">Other</span>.<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>) != <span class="source_keyword">None</span> )
<a name="57"></a>		<span class="source_type"><a href="../unrealgame/bot.html" class="source">Bot</a></span>(<span class="source_type">Other</span>.<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>).bHasImpactHammer = <span class="source_keyword">true</span>;
<a name="58"></a>}
<a name="59"></a>
<a name="60"></a><span class="source_keyword">function</span> <span class="source_keyword">bool</span> CanAttack(<span class="source_type"><a href="../engine/actor.html" class="source">Actor</a></span> <span class="source_type">Other</span>)
<a name="61"></a>{
<a name="62"></a>	<span class="source_keyword">return</span> <span class="source_keyword">true</span>;
<a name="63"></a>}
<a name="64"></a>
<a name="65"></a><span class="source_keyword2">simulated</span> <span class="source_keyword">function</span> BringUp(<span class="source_keyword2">optional</span> <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span> PrevWeapon)
<a name="66"></a>{
<a name="67"></a>	<span class="source_keyword">Super</span>.Bringup(PrevWeapon);
<a name="68"></a>	<span class="source_keyword">if</span> ( !AmmoMaxed(<span class="source_int">1</span>) )
<a name="69"></a>	{
<a name="70"></a>		<span class="source_keyword">while</span> ( (FireMode[<span class="source_int">1</span>].NextTimerPop &lt; <span class="source_type">Level</span>.TimeSeconds) && (FireMode[<span class="source_int">1</span>].TimerInterval &gt; <span class="source_int">0.f</span>) )
<a name="71"></a>		{
<a name="72"></a>			FireMode[<span class="source_int">1</span>].Timer();
<a name="73"></a>			<span class="source_keyword">if</span> ( FireMode[<span class="source_int">1</span>].bTimerLoop )
<a name="74"></a>				FireMode[<span class="source_int">1</span>].NextTimerPop = FireMode[<span class="source_int">1</span>].NextTimerPop + FireMode[<span class="source_int">1</span>].TimerInterval;
<a name="75"></a>			<span class="source_keyword">else</span>
<a name="76"></a>				FireMode[<span class="source_int">1</span>].TimerInterval = <span class="source_int">0.f</span>;
<a name="77"></a>		}
<a name="78"></a>	}
<a name="79"></a>}
<a name="80"></a>
<a name="81"></a><span class="source_keyword2">simulated</span> <span class="source_keyword">function</span> Timer()
<a name="82"></a>{
<a name="83"></a>	<span class="source_keyword">local</span> <span class="source_type"><a href="../unrealgame/bot.html" class="source">Bot</a></span> <span class="source_type">B</span>;
<a name="84"></a>
<a name="85"></a>    <span class="source_keyword">if</span> (ClientState == WS_BringUp)
<a name="86"></a>    {
<a name="87"></a>		<span class="source_comment">// check if owner is bot waiting to do impact jump
</span><a name="88"></a>		<span class="source_type">B</span> = <span class="source_type"><a href="../unrealgame/bot.html" class="source">Bot</a></span>(<span class="source_type">Instigator</span>.<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>);
<a name="89"></a>		<span class="source_keyword">if</span> ( (<span class="source_type">B</span> != <span class="source_keyword">None</span>) && <span class="source_type">B</span>.bPreparingMove && (<span class="source_type">B</span>.ImpactTarget != <span class="source_keyword">None</span>) )
<a name="90"></a>		{
<a name="91"></a>			<span class="source_type">B</span>.ImpactJump();
<a name="92"></a>			<span class="source_type">B</span> = <span class="source_keyword">None</span>;
<a name="93"></a>		}
<a name="94"></a>    }
<a name="95"></a>	<span class="source_keyword">Super</span>.Timer();
<a name="96"></a>	<span class="source_keyword">if</span> ( (<span class="source_type">B</span> != <span class="source_keyword">None</span>) && (<span class="source_type">B</span>.Enemy != <span class="source_keyword">None</span>) )
<a name="97"></a>		BotFire(<span class="source_keyword">false</span>);
<a name="98"></a>}
<a name="99"></a>
<a name="100"></a><span class="source_keyword">function</span> FireHack(<span class="source_keyword">byte</span> <span class="source_type">Mode</span>)
<a name="101"></a>{
<a name="102"></a>	<span class="source_keyword">if</span> ( <span class="source_type">Mode</span> == <span class="source_int">0</span> )
<a name="103"></a>	{
<a name="104"></a>		FireMode[<span class="source_int">0</span>].PlayFiring();
<a name="105"></a>		FireMode[<span class="source_int">0</span>].FlashMuzzleFlash();
<a name="106"></a>		FireMode[<span class="source_int">0</span>].StartMuzzleSmoke();
<a name="107"></a>		IncrementFlashCount(<span class="source_int">0</span>);
<a name="108"></a>	}
<a name="109"></a>}
<a name="110"></a>
<a name="111"></a><span class="source_comment">/* BestMode()
<a name="112"></a>choose between regular or alt-fire
<a name="113"></a>*/</span>
<a name="114"></a><span class="source_keyword">function</span> <span class="source_keyword">byte</span> BestMode()
<a name="115"></a>{
<a name="116"></a>	<span class="source_keyword">local</span> <span class="source_keyword">float</span> EnemyDist;
<a name="117"></a>	<span class="source_keyword">local</span> <span class="source_type"><a href="../unrealgame/bot.html" class="source">bot</a></span> <span class="source_type">B</span>;
<a name="118"></a>
<a name="119"></a>	<span class="source_type">B</span> = <span class="source_type"><a href="../unrealgame/bot.html" class="source">Bot</a></span>(<span class="source_type">Instigator</span>.<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>);
<a name="120"></a>	<span class="source_keyword">if</span> ( (<span class="source_type">B</span> == <span class="source_keyword">None</span>) || (<span class="source_type">B</span>.Enemy == <span class="source_keyword">None</span>) )
<a name="121"></a>		<span class="source_keyword">return</span> <span class="source_int">1</span>;
<a name="122"></a>
<a name="123"></a>	<span class="source_keyword">if</span> ( <span class="source_type">B</span>.bShieldSelf && <span class="source_type">B</span>.ShouldKeepShielding() )
<a name="124"></a>		<span class="source_keyword">return</span> <span class="source_int">1</span>;
<a name="125"></a>
<a name="126"></a>	EnemyDist = VSize(<span class="source_type">B</span>.Enemy.Location - <span class="source_type">Instigator</span>.Location);
<a name="127"></a>	<span class="source_keyword">if</span> ( EnemyDist &gt; <span class="source_int">4</span> * <span class="source_type">Instigator</span>.GroundSpeed )
<a name="128"></a>		<span class="source_keyword">return</span> <span class="source_int">1</span>;
<a name="129"></a>	<span class="source_keyword">if</span> ( (<span class="source_type">B</span>.MoveTarget != <span class="source_type">B</span>.Enemy) && (<span class="source_type">B</span>.IsRetreating() || (EnemyDist &gt; <span class="source_int">2</span> * <span class="source_type">Instigator</span>.GroundSpeed)) )
<a name="130"></a>		<span class="source_keyword">return</span> <span class="source_int">1</span>;
<a name="131"></a>	<span class="source_keyword">return</span> <span class="source_int">0</span>;
<a name="132"></a>}
<a name="133"></a>
<a name="134"></a><span class="source_comment">// super desireable for bot waiting to impact jump
</span><a name="135"></a><span class="source_keyword">function</span> <span class="source_keyword">float</span> GetAIRating()
<a name="136"></a>{
<a name="137"></a>	<span class="source_keyword">local</span> <span class="source_type"><a href="../unrealgame/bot.html" class="source">Bot</a></span> <span class="source_type">B</span>;
<a name="138"></a>	<span class="source_keyword">local</span> <span class="source_keyword">float</span> EnemyDist;
<a name="139"></a>
<a name="140"></a>	<span class="source_type">B</span> = <span class="source_type"><a href="../unrealgame/bot.html" class="source">Bot</a></span>(<span class="source_type">Instigator</span>.<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>);
<a name="141"></a>	<span class="source_keyword">if</span> ( <span class="source_type">B</span> == <span class="source_keyword">None</span> )
<a name="142"></a>		<span class="source_keyword">return</span> AIRating;
<a name="143"></a>
<a name="144"></a>	<span class="source_keyword">if</span> ( <span class="source_type">B</span>.bShieldSelf && <span class="source_type">B</span>.ShouldKeepShielding() )
<a name="145"></a>		<span class="source_keyword">return</span> <span class="source_int">9</span>;
<a name="146"></a>
<a name="147"></a>	<span class="source_keyword">if</span> ( <span class="source_type">B</span>.bPreparingMove && (<span class="source_type">B</span>.ImpactTarget != <span class="source_keyword">None</span>) )
<a name="148"></a>		<span class="source_keyword">return</span> <span class="source_int">9</span>;
<a name="149"></a>
<a name="150"></a>	<span class="source_keyword">if</span> ( <span class="source_type">B</span>.<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.HasFlag != <span class="source_keyword">None</span> )
<a name="151"></a>	{
<a name="152"></a>		<span class="source_keyword">if</span> ( <span class="source_type">Instigator</span>.Health &lt; <span class="source_int">50</span> )
<a name="153"></a>			<span class="source_keyword">return</span> AIRating + <span class="source_int">0.35</span>;
<a name="154"></a>		<span class="source_keyword">return</span> AIRating + <span class="source_int">0.25</span>;
<a name="155"></a>	}
<a name="156"></a>
<a name="157"></a>	<span class="source_keyword">if</span> ( <span class="source_type">B</span>.Enemy == <span class="source_keyword">None</span> )
<a name="158"></a>		<span class="source_keyword">return</span> AIRating;
<a name="159"></a>
<a name="160"></a>	EnemyDist = VSize(<span class="source_type">B</span>.Enemy.Location - <span class="source_type">Instigator</span>.Location);
<a name="161"></a>	<span class="source_keyword">if</span> ( <span class="source_type">B</span>.Stopped() && (EnemyDist &gt; <span class="source_int">100</span>) )
<a name="162"></a>		<span class="source_keyword">return</span> <span class="source_int">0.1</span>;
<a name="163"></a>
<a name="164"></a>	<span class="source_keyword">if</span> ( (EnemyDist &lt; <span class="source_int">750</span>) && (<span class="source_type">B</span>.Skill &lt;= <span class="source_int">2</span>) && !<span class="source_type">B</span>.Enemy.IsA(<span class="source_name">'Bot'</span>) && (<span class="source_type"><a href="../xweapons/shieldgun.html" class="source">ShieldGun</a></span>(<span class="source_type">B</span>.Enemy.<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != <span class="source_keyword">None</span>) )
<a name="165"></a>		<span class="source_keyword">return</span> FClamp(<span class="source_int">300</span>/(EnemyDist + <span class="source_int">1</span>), <span class="source_int">0.6</span>, <span class="source_int">0.75</span>);
<a name="166"></a>
<a name="167"></a>	<span class="source_keyword">if</span> ( EnemyDist &gt; <span class="source_int">400</span> )
<a name="168"></a>		<span class="source_keyword">return</span> <span class="source_int">0.1</span>;
<a name="169"></a>	<span class="source_keyword">if</span> ( (<span class="source_type">Instigator</span>.<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span> != self) && (EnemyDist &lt; <span class="source_int">120</span>) )
<a name="170"></a>		<span class="source_keyword">return</span> <span class="source_int">0.25</span>;
<a name="171"></a>
<a name="172"></a>	<span class="source_keyword">return</span> ( FMin(<span class="source_int">0.6</span>, <span class="source_int">90</span>/(EnemyDist + <span class="source_int">1</span>)) );
<a name="173"></a>}
<a name="174"></a>
<a name="175"></a><span class="source_comment">// End AI interface
</span><a name="176"></a>
<a name="177"></a><span class="source_keyword">function</span> AdjustPlayerDamage( <span class="source_keyword2">out</span> <span class="source_keyword">int</span> <span class="source_type">Damage</span>, <span class="source_type"><a href="../engine/pawn.html" class="source">Pawn</a></span> InstigatedBy, <span class="source_type"><a href="../core/object.html#Vector" class="source">Vector</a></span> <span class="source_type">HitLocation</span>,
<a name="178"></a>						         <span class="source_keyword2">out</span> <span class="source_type"><a href="../core/object.html#Vector" class="source">Vector</a></span> Momentum, <span class="source_keyword">class</span>&lt;<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>&gt; <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>)
<a name="179"></a>{
<a name="180"></a>    <span class="source_keyword">local</span> <span class="source_keyword">int</span> <span class="source_type">Drain</span>;
<a name="181"></a>	<span class="source_keyword">local</span> <span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span> Reflect;
<a name="182"></a>    <span class="source_keyword">local</span> <span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span> <span class="source_type">HitNormal</span>;
<a name="183"></a>    <span class="source_keyword">local</span> <span class="source_keyword">float</span> DamageMax;
<a name="184"></a>
<a name="185"></a>	DamageMax = <span class="source_int">100.0</span>;
<a name="186"></a>	<span class="source_keyword">if</span> ( <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span> == <span class="source_keyword">class</span><span class="source_name">'Fell'</span> )
<a name="187"></a>		DamageMax = <span class="source_int">20.0</span>;
<a name="188"></a>    <span class="source_keyword">else</span> <span class="source_keyword">if</span>( !<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.bArmorStops || !<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.bLocationalHit || (<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span> == <span class="source_keyword">class</span><span class="source_name">'DamTypeShieldImpact'</span> && InstigatedBy == <span class="source_type">Instigator</span>) )
<a name="189"></a>        <span class="source_keyword">return</span>;
<a name="190"></a>
<a name="191"></a>    <span class="source_keyword">if</span> ( CheckReflect(<span class="source_type">HitLocation</span>, <span class="source_type">HitNormal</span>, <span class="source_int">0</span>) )
<a name="192"></a>    {
<a name="193"></a>        <span class="source_type">Drain</span> = Min( AmmoAmount(<span class="source_int">1</span>)*<span class="source_int">2</span>, <span class="source_type">Damage</span> );
<a name="194"></a>		<span class="source_type">Drain</span> = Min(<span class="source_type">Drain</span>,DamageMax);
<a name="195"></a>	    Reflect = MirrorVectorByNormal( Normal(Location - <span class="source_type">HitLocation</span>), <span class="source_type"><a href="../core/object.html#Vector" class="source">Vector</a></span>(<span class="source_type">Instigator</span>.<span class="source_type">Rotation</span>) );
<a name="196"></a>        <span class="source_type">Damage</span> -= <span class="source_type">Drain</span>;
<a name="197"></a>        Momentum *= <span class="source_int">1.25</span>;
<a name="198"></a>        <span class="source_keyword">if</span> ( (<span class="source_type">Instigator</span> != <span class="source_keyword">None</span>) && (<span class="source_type">Instigator</span>.<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span> != <span class="source_keyword">None</span>) && (<span class="source_type">Instigator</span>.<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.HasFlag != <span class="source_keyword">None</span>) )
<a name="199"></a>        {
<a name="200"></a>			<span class="source_type">Drain</span> = Min(AmmoAmount(<span class="source_int">1</span>), <span class="source_type">Drain</span>);
<a name="201"></a>			ConsumeAmmo(<span class="source_int">1</span>,<span class="source_type">Drain</span>);
<a name="202"></a>			DoReflectEffect(<span class="source_type">Drain</span>);
<a name="203"></a>		}
<a name="204"></a>        <span class="source_keyword">else</span>
<a name="205"></a>        {
<a name="206"></a>			ConsumeAmmo(<span class="source_int">1</span>,<span class="source_type">Drain</span>/<span class="source_int">2</span>);
<a name="207"></a>			DoReflectEffect(<span class="source_type">Drain</span>/<span class="source_int">2</span>);
<a name="208"></a>		}
<a name="209"></a>    }
<a name="210"></a>}
<a name="211"></a>
<a name="212"></a><span class="source_keyword">function</span> DoReflectEffect(<span class="source_keyword">int</span> <span class="source_type">Drain</span>)
<a name="213"></a>{
<a name="214"></a>    PlaySound(ShieldHitSound, SLOT_None);
<a name="215"></a>    <span class="source_type"><a href="../xweapons/shieldaltfire.html" class="source">ShieldAltFire</a></span>(FireMode[<span class="source_int">1</span>]).TakeHit(<span class="source_type">Drain</span>);
<a name="216"></a>    ClientTakeHit(<span class="source_type">Drain</span>);
<a name="217"></a>}
<a name="218"></a>
<a name="219"></a><span class="source_keyword2">simulated</span> <span class="source_keyword">function</span> ClientTakeHit(<span class="source_keyword">int</span> <span class="source_type">Drain</span>)
<a name="220"></a>{
<a name="221"></a>	ClientPlayForceFeedback(ShieldHitForce);
<a name="222"></a>    <span class="source_type"><a href="../xweapons/shieldaltfire.html" class="source">ShieldAltFire</a></span>(FireMode[<span class="source_int">1</span>]).TakeHit(<span class="source_type">Drain</span>);
<a name="223"></a>}
<a name="224"></a>
<a name="225"></a><span class="source_keyword2">simulated</span> <span class="source_keyword">function</span> <span class="source_keyword">float</span> AmmoStatus(<span class="source_keyword2">optional</span> <span class="source_keyword">int</span> <span class="source_type">Mode</span>) <span class="source_comment">// returns float value for ammo amount
</span><a name="226"></a>{
<a name="227"></a>	<span class="source_keyword">if</span> ( <span class="source_type">Instigator</span> == <span class="source_keyword">None</span> || <span class="source_type">Instigator</span>.<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span> != self )
<a name="228"></a>	{
<a name="229"></a>		<span class="source_keyword">if</span> ( (FireMode[<span class="source_int">1</span>].TimerInterval != <span class="source_int">0.f</span>) && (FireMode[<span class="source_int">1</span>].NextTimerPop &lt; <span class="source_type">Level</span>.TimeSeconds) )
<a name="230"></a>		{
<a name="231"></a>			FireMode[<span class="source_int">1</span>].Timer();
<a name="232"></a>  			<span class="source_keyword">if</span> ( FireMode[<span class="source_int">1</span>].bTimerLoop )
<a name="233"></a>				FireMode[<span class="source_int">1</span>].NextTimerPop = FireMode[<span class="source_int">1</span>].NextTimerPop + FireMode[<span class="source_int">1</span>].TimerInterval;
<a name="234"></a>			<span class="source_keyword">else</span>
<a name="235"></a>				FireMode[<span class="source_int">1</span>].TimerInterval = <span class="source_int">0.f</span>;
<a name="236"></a>		}
<a name="237"></a>	}
<a name="238"></a>	<span class="source_keyword">return</span> <span class="source_keyword">Super</span>.AmmoStatus(<span class="source_type">Mode</span>);
<a name="239"></a>}
<a name="240"></a>
<a name="241"></a>
<a name="242"></a><span class="source_keyword">function</span> <span class="source_keyword">bool</span> CheckReflect( <span class="source_type"><a href="../core/object.html#Vector" class="source">Vector</a></span> <span class="source_type">HitLocation</span>, <span class="source_keyword2">out</span> <span class="source_type"><a href="../core/object.html#Vector" class="source">Vector</a></span> RefNormal, <span class="source_keyword">int</span> <span class="source_type">AmmoDrain</span> )
<a name="243"></a>{
<a name="244"></a>    <span class="source_keyword">local</span> <span class="source_type"><a href="../core/object.html#Vector" class="source">Vector</a></span> HitDir;
<a name="245"></a>    <span class="source_keyword">local</span> <span class="source_type"><a href="../core/object.html#Vector" class="source">Vector</a></span> FaceDir;
<a name="246"></a>
<a name="247"></a>    <span class="source_keyword">if</span> (!FireMode[<span class="source_int">1</span>].bIsFiring || AmmoAmount(<span class="source_int">0</span>) == <span class="source_int">0</span>) <span class="source_keyword">return</span> <span class="source_keyword">false</span>;
<a name="248"></a>
<a name="249"></a>    FaceDir = <span class="source_type"><a href="../core/object.html#Vector" class="source">Vector</a></span>(<span class="source_type">Instigator</span>.<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>.<span class="source_type">Rotation</span>);
<a name="250"></a>    HitDir = Normal(<span class="source_type">Instigator</span>.Location - <span class="source_type">HitLocation</span> + Vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">8</span>));
<a name="251"></a>    <span class="source_comment">//Log(self@"HitDir"@(FaceDir dot HitDir));
</span><a name="252"></a>
<a name="253"></a>    RefNormal = FaceDir;
<a name="254"></a>
<a name="255"></a>    <span class="source_keyword">if</span> ( FaceDir dot HitDir &lt; -<span class="source_int">0.37</span> ) <span class="source_comment">// 68 degree protection arc
</span><a name="256"></a>    {
<a name="257"></a>        <span class="source_keyword">if</span> (<span class="source_type">AmmoDrain</span> &gt; <span class="source_int">0</span>)
<a name="258"></a>            ConsumeAmmo(<span class="source_int">0</span>,<span class="source_type">AmmoDrain</span>);
<a name="259"></a>        <span class="source_keyword">return</span> <span class="source_keyword">true</span>;
<a name="260"></a>    }
<a name="261"></a>    <span class="source_keyword">return</span> <span class="source_keyword">false</span>;
<a name="262"></a>}
<a name="263"></a>
<a name="264"></a><span class="source_keyword">function</span> AnimEnd(<span class="source_keyword">int</span> <span class="source_type">channel</span>)
<a name="265"></a>{
<a name="266"></a>    <span class="source_keyword">if</span> (FireMode[<span class="source_int">0</span>].bIsFiring)
<a name="267"></a>    {
<a name="268"></a>        LoopAnim(<span class="source_name">'Charged'</span>);
<a name="269"></a>    }
<a name="270"></a>    <span class="source_keyword">else</span> <span class="source_keyword">if</span> (!FireMode[<span class="source_int">1</span>].bIsFiring)
<a name="271"></a>    {
<a name="272"></a>        <span class="source_keyword">Super</span>.AnimEnd(<span class="source_type">channel</span>);
<a name="273"></a>    }
<a name="274"></a>}
<a name="275"></a>
<a name="276"></a><span class="source_keyword">function</span> <span class="source_keyword">float</span> SuggestAttackStyle()
<a name="277"></a>{
<a name="278"></a>    <span class="source_keyword">return</span> <span class="source_int">0.8</span>;
<a name="279"></a>}
<a name="280"></a>
<a name="281"></a><span class="source_keyword">function</span> <span class="source_keyword">float</span> SuggestDefenseStyle()
<a name="282"></a>{
<a name="283"></a>    <span class="source_keyword">return</span> -<span class="source_int">0.8</span>;
<a name="284"></a>}
<a name="285"></a>
<a name="286"></a><span class="source_keyword2">simulated</span> <span class="source_keyword">function</span> <span class="source_keyword">float</span> ChargeBar()
<a name="287"></a>{
<a name="288"></a>	<span class="source_keyword">return</span> FMin(<span class="source_int">1</span>,FireMode[<span class="source_int">0</span>].HoldTime/<span class="source_type"><a href="../xweapons/shieldfire.html" class="source">ShieldFire</a></span>(FireMode[<span class="source_int">0</span>]).FullyChargedTime);
<a name="289"></a>}
<a name="290"></a>
<a name="291"></a><span class="source_keyword">defaultproperties</span>
<a name="292"></a>{
<a name="293"></a>     ShieldHitSound=<span class="source_type"><a href="../engine/proceduralsound.html" class="source">ProceduralSound</a></span><span class="source_name">'WeaponSounds.ShieldGun.ShieldReflection'</span>
<a name="294"></a>     ShieldHitForce=<span class="source_string">"ShieldReflection"</span>
<a name="295"></a>     FireModeClass(<span class="source_int">0</span>)=<span class="source_keyword">Class</span><span class="source_name">'XWeapons.ShieldFire'</span>
<a name="296"></a>     FireModeClass(<span class="source_int">1</span>)=<span class="source_keyword">Class</span><span class="source_name">'XWeapons.ShieldAltFire'</span>
<a name="297"></a>     PutDownAnim=<span class="source_string">"PutDown"</span>
<a name="298"></a>     SelectSound=<span class="source_type"><a href="../engine/sound.html" class="source">Sound</a></span><span class="source_name">'WeaponSounds.Misc.shieldgun_change'</span>
<a name="299"></a>     SelectForce=<span class="source_string">"ShieldGun_change"</span>
<a name="300"></a>     AIRating=<span class="source_int">0.350000</span>
<a name="301"></a>     CurrentRating=<span class="source_int">0.350000</span>
<a name="302"></a>     bMeleeWeapon=<span class="source_keyword">True</span>
<a name="303"></a>     bShowChargingBar=<span class="source_keyword">True</span>
<a name="304"></a>     bCanThrow=<span class="source_keyword">False</span>
<a name="305"></a>     Description=<span class="source_string">"The Kemphler DD280 Riot Control Device has the ability to resist and reflect incoming projectiles and energy beams. The plasma wave inflicts massive damage, rupturing tissue, pulverizing organs, and flooding the bloodstream with dangerous gas bubbles.||This weapon may be intended for combat at close range, but when wielded properly should be considered as dangerous as any other armament in your arsenal."</span>
<a name="306"></a>     EffectOffset=(<span class="source_type">X</span>=<span class="source_int">15.000000</span>,<span class="source_type">Y</span>=<span class="source_int">5.500000</span>,<span class="source_type">Z</span>=<span class="source_int">2.000000</span>)
<a name="307"></a>     DisplayFOV=<span class="source_int">60.000000</span>
<a name="308"></a>     Priority=<span class="source_int">2</span>
<a name="309"></a>     HudColor=(<span class="source_type">B</span>=<span class="source_int">121</span>,G=<span class="source_int">188</span>)
<a name="310"></a>     SmallViewOffset=(<span class="source_type">X</span>=<span class="source_int">10.000000</span>,<span class="source_type">Y</span>=<span class="source_int">3.300000</span>,<span class="source_type">Z</span>=-<span class="source_int">6.700000</span>)
<a name="311"></a>     CenteredOffsetY=-<span class="source_int">9.000000</span>
<a name="312"></a>     CenteredRoll=<span class="source_int">1000</span>
<a name="313"></a>     CustomCrosshair=<span class="source_int">6</span>
<a name="314"></a>     CustomCrossHairColor=(<span class="source_type">B</span>=<span class="source_int">121</span>,G=<span class="source_int">188</span>)
<a name="315"></a>     CustomCrossHairTextureName=<span class="source_string">"Crosshairs.Hud.Crosshair_Pointer"</span>
<a name="316"></a>     PickupClass=<span class="source_keyword">Class</span><span class="source_name">'XWeapons.ShieldGunPickup'</span>
<a name="317"></a>     PlayerViewOffset=(<span class="source_type">X</span>=<span class="source_int">2.000000</span>,<span class="source_type">Y</span>=-<span class="source_int">0.700000</span>,<span class="source_type">Z</span>=-<span class="source_int">2.700000</span>)
<a name="318"></a>     PlayerViewPivot=(Pitch=<span class="source_int">500</span>,Yaw=<span class="source_int">500</span>)
<a name="319"></a>     BobDamping=<span class="source_int">2.200000</span>
<a name="320"></a>     AttachmentClass=<span class="source_keyword">Class</span><span class="source_name">'XWeapons.ShieldAttachment'</span>
<a name="321"></a>     IconMaterial=<span class="source_type"><a href="../engine/texture.html" class="source">Texture</a></span><span class="source_name">'HUDContent.Generic.HUD'</span>
<a name="322"></a>     IconCoords=(X1=<span class="source_int">169</span>,Y1=<span class="source_int">39</span>,X2=<span class="source_int">241</span>,<span class="source_type">Y2</span>=<span class="source_int">77</span>)
<a name="323"></a>     ItemName=<span class="source_string">"Shield Gun"</span>
<a name="324"></a>     <span class="source_type">Mesh</span>=SkeletalMesh<span class="source_name">'Weapons.ShieldGun_1st'</span>
<a name="325"></a>     DrawScale=<span class="source_int">0.400000</span>
<a name="326"></a>     HighDetailOverlay=<span class="source_type"><a href="../engine/combiner.html" class="source">Combiner</a></span><span class="source_name">'UT2004Weapons.WeaponSpecMap2'</span>
<a name="327"></a>}
<a name="328"></a></pre></td></tr></table></div>
<hr />
<table class="header">
<tr class="header">
	<td class="header"><a href="../overview.html">Overview</a></td>
	<td class="header"><a href="../xweapons/xweapons-overview.html">Package</a></td>
	<td class="header"><a href="../xweapons/shieldgun.html">Class</a></td>
	<td class="header_hilight">Source</td>
	<td class="header"><a class="header" href="../classtree.html#ShieldGun">Class tree</a></td>
	<td class="header"><a class="header" href="../glossary_A.html">Glossary</a></td>
	<td class="logo" rowspan="2">UnrealScript<br />Documentation</td>
</tr>
<tr>
	<td class="subheader" colspan="3"><a href="../Source_xweapons/shieldfire.html">previous class</a> &nbsp;&nbsp;&nbsp;&nbsp; <a href="../Source_xweapons/shieldgunpickup.html">next class</a></td>
	<td class="subheader" colspan="2"><a href="../index.html" target="_top">frames</a> &nbsp;&nbsp;&nbsp;&nbsp; <a href="" target="_top">no frames</a></td>
</tr>
</table>

<div class="stats">Class file time: Sun 31/3/2019 17:32:40.000 - Creation time: Mon 15/4/2019 10:25:12.287 - Created with <a href="http://wiki.beyondunreal.com/wiki/UnCodeX" target="_blank">UnCodeX</a></div>

</body>
</html>